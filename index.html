<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„ÙØ§Ø±Ø³: Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ø²Ø¹ÙŠÙ…</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');

        body {
            margin: 0;
            overflow: hidden;
            background-color: #1a1a1a;
            font-family: 'Cairo', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
        }

        #game-container {
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
            border-radius: 10px;
            overflow: hidden;
        }

        canvas {
            display: block;
            background: linear-gradient(to bottom, #2b32b2, #1488cc);
        }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù‚ØµØ© */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        #hud {
            display: flex;
            justify-content: space-between;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 2px 2px 4px black;
        }

        /* Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù‚ØµØ© ÙˆØ§Ù„Ø¨Ø¯Ø§ÙŠØ© */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: auto;
            z-index: 10;
            transition: opacity 0.5s;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        h1 {
            font-size: 40px;
            color: #ffd700;
            margin-bottom: 10px;
            text-shadow: 0 0 10px #ff8c00;
        }

        p {
            font-size: 18px;
            max-width: 80%;
            line-height: 1.6;
        }

        .btn {
            margin-top: 20px;
            padding: 10px 30px;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            border-radius: 25px;
            font-family: 'Cairo', sans-serif;
            box-shadow: 0 4px 15px rgba(255, 75, 43, 0.4);
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: scale(1.05);
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø­ÙˆØ§Ø± */
        .dialogue-box {
            background: rgba(0,0,0,0.9);
            border: 2px solid #fff;
            padding: 20px;
            border-radius: 10px;
            max-width: 600px;
        }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas" width="800" height="450"></canvas>
    
    <div id="ui-layer">
        <div id="hud">
            <span id="score">Ù†Ù‚Ø§Ø·: 0</span>
            <span id="level-display">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: 1</span>
            <span id="health">â¤ï¸ x 3</span>
        </div>
    </div>

    <div id="start-screen" class="overlay">
        <h1>âš”ï¸ Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„ÙØ§Ø±Ø³</h1>
        <p>Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¸Ù„Ø§Ù„ Ø§Ø³ØªÙŠÙ‚Ø¸Øª... ÙˆØ§Ù„ÙˆØ­ÙˆØ´ Ø§Ø­ØªÙ„Øª Ø§Ù„Ù‚Ù„Ø§Ø¹ Ø§Ù„Ø®Ù…Ø³.</p>
        <p>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„Ø­Ø±ÙƒØ©ØŒ Ùˆ <b>SPACE</b> Ù„Ù„Ù‚ÙØ².</p>
        <button class="btn" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©</button>
    </div>

    <div id="cutscene-screen" class="overlay hidden">
        <div class="dialogue-box">
            <h2 id="cutscene-title" style="color:#00d2ff">ÙØµÙ„ Ø¬Ø¯ÙŠØ¯</h2>
            <p id="cutscene-text">...</p>
            <button class="btn" onclick="nextLevel()">Ù…ØªØ§Ø¨Ø¹Ø©</button>
        </div>
    </div>

    <div id="gameover-screen" class="overlay hidden">
        <h1 style="color: #ff2b2b;">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h1>
        <p>Ø³Ù‚Ø· Ø§Ù„ÙØ§Ø±Ø³ ÙÙŠ Ø§Ù„Ù…Ø¹Ø±ÙƒØ©...</p>
        <button class="btn" onclick="location.reload()">Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>

    <div id="victory-screen" class="overlay hidden">
        <h1 style="color: #00ff88;">ğŸ‰ Ø§Ù†ØªØµØ§Ø± Ø³Ø§Ø­Ù‚! ğŸ‰</h1>
        <p>Ù„Ù‚Ø¯ Ù‡Ø²Ù…Øª Ø²Ø¹ÙŠÙ… Ø§Ù„Ø¸Ù„Ø§Ù… ÙˆØ­Ø±Ø±Øª Ø§Ù„Ù…Ù…Ù„ÙƒØ©!</p>
        <button class="btn" onclick="location.reload()">Ø§Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
    let gameState = 'START'; // START, PLAYING, CUTSCENE, GAMEOVER, VICTORY
    let currentLevel = 0;
    let score = 0;
    
    // Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
    let cameraX = 0;

    // Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
    const keys = { right: false, left: false, up: false };

    // Ø§Ù„ÙƒØ§Ø¦Ù†Ø§Øª
    let player = {
        x: 50, y: 200, width: 40, height: 40,
        velX: 0, velY: 0,
        speed: 5, jumpForce: 13,
        grounded: false,
        hp: 3,
        facingRight: true,
        sprite: "ğŸ›¡ï¸" // Ø§Ù„ÙØ§Ø±Ø³
    };

    let particles = [];
    let enemies = [];
    let projectiles = [];
    let boss = null;
    let platforms = [];
    let portal = null;

    // ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø±Ø§Ø­Ù„ (1=Ø£Ø±Ø¶, 0=Ù‡ÙˆØ§Ø¡, P=Ø¨ÙˆØ§Ø¨Ø©, E=Ø¹Ø¯Ùˆ, L=Ø­Ù…Ù…)
    // 5 Ù…Ø±Ø§Ø­Ù„ + Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø²Ø¹ÙŠÙ…
    const levelsData = [
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„ØºØ§Ø¨Ø© (Ø³Ù‡Ù„Ø©)
        {
            map: [
                "11111111111111111111",
                "10000000000000000001",
                "10000000000000000P01",
                "10011100011100011111",
                "10000000000000000001",
                "11000001100000000001",
                "11111111111111111111"
            ],
            bg1: "#2b32b2", bg2: "#1488cc",
            story: "Ù„Ù‚Ø¯ Ø¨Ø¯Ø£Øª Ø§Ù„Ø±Ø­Ù„Ø©. Ø§Ù„ØºØ§Ø¨Ø© Ù‡Ø§Ø¯Ø¦Ø©ØŒ Ù„ÙƒÙ† Ø§Ù„Ø­Ø°Ø± ÙˆØ§Ø¬Ø¨."
        },
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ø§Ù„Ø¬Ø¨Ø§Ù„ (Ù‚ÙØ²Ø§Øª)
        {
            map: [
                "1111111111111111111111111",
                "1000000000000000000000001",
                "100000000000000E00000P001",
                "1000111000001111111111111",
                "1000000001000000000000001",
                "110000001110000000E000001",
                "1111111111111111111111111"
            ],
            bg1: "#616161", bg2: "#9bc5c3",
            story: "Ø§Ù„Ø¬Ø¨Ø§Ù„ ÙˆØ¹Ø±Ø©. Ø§Ù„ÙˆØ­ÙˆØ´ Ø§Ù„Ø¬Ø¨Ù„ÙŠØ© ØªØ­Ø±Ø³ Ø§Ù„Ø·Ø±ÙŠÙ‚."
        },
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ø§Ù„ÙƒÙ‡Ù Ø§Ù„Ù…Ø¸Ù„Ù…
        {
            map: [
                "111111111111111111111111111",
                "100000000000000000000000001",
                "1000000E000000000000000P001",
                "101111111100001110001111111",
                "100000000000010000000000001",
                "100E00000001110000E00000001",
                "111111LL111111111LL11111111"
            ],
            bg1: "#232526", bg2: "#414345",
            story: "Ø§Ù„ÙƒÙ‡Ù Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆØ§Ù„Ø­Ù…Ù… Ø§Ù„Ø¨Ø±ÙƒØ§Ù†ÙŠØ©."
        },
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„Ù‚Ù„Ø¹Ø© Ø§Ù„Ù…Ø³ÙƒÙˆÙ†Ø©
        {
            map: [
                "111111111111111111111111111111",
                "1P0000000000000000000000000001",
                "111110000000000000000000000001",
                "100000001110000E00000111000001",
                "100000000000001110000000000001",
                "1000E0000000100000000000E00001",
                "111111111111111111111111111111"
            ],
            bg1: "#200122", bg2: "#6f0000",
            story: "Ø£Ù†Øª Ù‚Ø±ÙŠØ¨ Ù…Ù† ØºØ±ÙØ© Ø§Ù„Ø¹Ø±Ø´. Ø§Ù„Ø­Ø±Ø§Ø³ ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù†!"
        },
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ù…Ø§ Ù‚Ø¨Ù„ Ø§Ù„Ø²Ø¹ÙŠÙ… (ØµØ¹Ø¨Ø©)
        {
            map: [
                "111111111111111111111111111111",
                "1000000000000000000000000000P1",
                "100110011000000000000000001111",
                "100000000001110000E00001110001",
                "100000000000000011111000000001",
                "1100E0000E00000000000000000001",
                "11111LL111LL111111111111111111"
            ],
            bg1: "#000000", bg2: "#434343",
            story: "Ø§Ù„Ø¨Ø§Ø¨ Ø§Ù„ÙƒØ¨ÙŠØ± Ø£Ù…Ø§Ù…Ùƒ. Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù…Ø¹Ø±ÙƒØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©!"
        },
        // Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Ø§Ù„Ø²Ø¹ÙŠÙ…
        {
            map: [
                "11111111111111111111",
                "10000000000000000001",
                "10000000000000000001",
                "10000000000000000001",
                "10000000000000000001",
                "10000000000000000001",
                "11111111111111111111"
            ],
            bg1: "#3e0000", bg2: "#ff0000",
            story: "Ø§Ù„Ø²Ø¹ÙŠÙ…: Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù„Ù…Ø¸Ù„Ù…!"
        }
    ];

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    document.addEventListener('keydown', (e) => {
        if(e.code === 'ArrowRight') keys.right = true;
        if(e.code === 'ArrowLeft') keys.left = true;
        if(e.code === 'Space' || e.code === 'ArrowUp') {
            keys.up = true;
            if(player.grounded && gameState === 'PLAYING') {
                player.velY = -player.jumpForce;
                player.grounded = false;
                createParticles(player.x + player.width/2, player.y + player.height, '#fff', 5);
            }
        }
    });

    document.addEventListener('keyup', (e) => {
        if(e.code === 'ArrowRight') keys.right = false;
        if(e.code === 'ArrowLeft') keys.left = false;
        if(e.code === 'Space' || e.code === 'ArrowUp') keys.up = false;
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø±Ø­Ù„Ø©
    function initLevel(levelIndex) {
        if (levelIndex >= levelsData.length) {
            // ÙÙˆØ²
            gameState = 'VICTORY';
            document.getElementById('victory-screen').classList.remove('hidden');
            return;
        }

        currentLevel = levelIndex;
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù‚ØµØ© (Cutscene)
        if (gameState !== 'BOSS_FIGHT') {
             showCutscene(levelsData[currentLevel].story);
        }

        // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        platforms = [];
        enemies = [];
        projectiles = [];
        boss = null;
        portal = null;
        player.x = 50; player.y = 100; player.velX = 0; player.velY = 0;

        const map = levelsData[levelIndex].map;
        const tileSize = 40;

        for (let row = 0; row < map.length; row++) {
            for (let col = 0; col < map[row].length; col++) {
                const char = map[row][col];
                const x = col * tileSize;
                const y = row * tileSize;

                if (char === '1') platforms.push({ x, y, width: tileSize, height: tileSize, type: 'ground' });
                if (char === 'L') platforms.push({ x, y, width: tileSize, height: tileSize, type: 'lava' });
                if (char === 'P') portal = { x, y, width: tileSize, height: tileSize };
                if (char === 'E') enemies.push({ x, y, width: 40, height: 40, velX: 2, range: 100, startX: x, sprite: "ğŸ‘¾" });
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²Ø¹ÙŠÙ…
        if (levelIndex === 5) { // Boss Level
            boss = {
                x: 600, y: 150, width: 100, height: 100,
                hp: 20, maxHp: 20,
                dir: -1, timer: 0,
                sprite: "ğŸ²"
            };
        }

        document.getElementById('level-display').innerText = `Ø§Ù„Ù…Ø±Ø­Ù„Ø©: ${levelIndex + 1}`;
    }

    function showCutscene(text) {
        gameState = 'CUTSCENE';
        const screen = document.getElementById('cutscene-screen');
        const txt = document.getElementById('cutscene-text');
        screen.classList.remove('hidden');
        txt.innerText = "";
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„ÙƒØªØ§Ø¨Ø©
        let i = 0;
        const speed = 30;
        function typeWriter() {
            if (i < text.length) {
                txt.innerHTML += text.charAt(i);
                i++;
                setTimeout(typeWriter, speed);
            }
        }
        typeWriter();
    }

    function startGame() {
        document.getElementById('start-screen').classList.add('hidden');
        initLevel(0);
    }

    function nextLevel() {
        document.getElementById('cutscene-screen').classList.add('hidden');
        gameState = 'PLAYING';
    }

    // Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ«
    function update() {
        if (gameState !== 'PLAYING') return;

        // Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
        if (keys.right) {
            player.velX += 1;
            player.facingRight = true;
        }
        if (keys.left) {
            player.velX -= 1;
            player.facingRight = false;
        }

        player.velX *= 0.8; // Friction
        player.velY += 0.8; // Gravity

        player.x += player.velX;
        player.y += player.velY;

        // ØªØµØ§Ø¯Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù…Ø¹ Ø§Ù„Ù…Ù†ØµØ§Øª
        player.grounded = false;
        for (let p of platforms) {
            if (colCheck(player, p)) {
                if (p.type === 'lava') {
                    takeDamage();
                } else {
                    // ØªØµØ§Ø¯Ù… Ø¨Ø³ÙŠØ·
                    if (player.velY > 0 && player.y + player.height < p.y + player.velY + 10) {
                        player.grounded = true;
                        player.velY = 0;
                        player.y = p.y - player.height;
                    }
                }
            }
        }

        // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø¹Ø§Ù„Ù…
        if (player.y > canvas.height) takeDamage();

        // Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©
        if (portal && colCheck(player, portal)) {
            initLevel(currentLevel + 1);
        }

        // Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
        enemies.forEach((enemy, index) => {
            enemy.x += enemy.velX;
            if (enemy.x > enemy.startX + enemy.range || enemy.x < enemy.startX - enemy.range) {
                enemy.velX *= -1;
            }
            // Ù‚ØªÙ„ Ø§Ù„Ø¹Ø¯Ùˆ Ø¨Ø§Ù„Ù‚ÙØ² Ø¹Ù„ÙŠÙ‡
            if (colCheck(player, enemy)) {
                if (player.velY > 0 && player.y + player.height - player.velY < enemy.y + 10) {
                    player.velY = -8; // Ø§Ø±ØªØ¯Ø§Ø¯
                    enemies.splice(index, 1);
                    createParticles(enemy.x, enemy.y, '#aa00ff', 10);
                    score += 100;
                    document.getElementById('score').innerText = `Ù†Ù‚Ø§Ø·: ${score}`;
                } else {
                    takeDamage();
                }
            }
        });

        // Ø§Ù„Ø²Ø¹ÙŠÙ…
        if (boss) {
            boss.timer++;
            // Ø­Ø±ÙƒØ© Ø§Ù„Ø²Ø¹ÙŠÙ…
            if (boss.timer % 100 === 0) {
                boss.dir *= -1;
            }
            boss.x += boss.dir * 2;

            // Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø±
            if (boss.timer % 120 === 0) {
                projectiles.push({x: boss.x, y: boss.y + 50, velX: -5, type: 'fire'});
            }

            // Ø¶Ø±Ø¨ Ø§Ù„Ø²Ø¹ÙŠÙ…
            if (colCheck(player, boss)) {
                if (player.velY > 0) {
                    player.velY = -10;
                    boss.hp--;
                    createParticles(boss.x + 50, boss.y + 50, '#ff0000', 5);
                    if (boss.hp <= 0) {
                        boss = null;
                        setTimeout(() => initLevel(6), 1000); // Ø§Ù„ÙÙˆØ²
                    }
                } else {
                    takeDamage();
                }
            }
        }

        // Ø§Ù„Ù…Ù‚Ø°ÙˆÙØ§Øª
        for (let i = projectiles.length - 1; i >= 0; i--) {
            let proj = projectiles[i];
            proj.x += proj.velX;
            if (colCheck(player, {x: proj.x, y: proj.y, width: 20, height: 20})) {
                takeDamage();
                projectiles.splice(i, 1);
            }
            if (proj.x < 0) projectiles.splice(i, 1);
        }

        // Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª
        particles.forEach((p, i) => {
            p.x += p.velX;
            p.y += p.velY;
            p.life--;
            if (p.life <= 0) particles.splice(i, 1);
        });

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        let targetCamX = player.x - canvas.width / 2 + player.width / 2;
        // ØªÙ‚ÙŠÙŠØ¯ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        targetCamX = Math.max(0, targetCamX); 
        cameraX += (targetCamX - cameraX) * 0.1;
    }

    function takeDamage() {
        player.hp--;
        document.getElementById('health').innerText = "â¤ï¸ x " + player.hp;
        player.velY = -10; // Ø§Ø±ØªØ¯Ø§Ø¯
        player.velX = -10;
        createParticles(player.x, player.y, '#ff0000', 15);
        if (player.hp <= 0) {
            gameState = 'GAMEOVER';
            document.getElementById('gameover-screen').classList.remove('hidden');
        }
    }

    // Ø§Ù„Ø±Ø³Ù…
    function draw() {
        // Ø±Ø³Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© (ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ø¬Ù…ÙŠÙ„)
        const lvl = levelsData[currentLevel] || levelsData[0];
        const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
        gradient.addColorStop(0, lvl.bg1);
        gradient.addColorStop(1, lvl.bg2);
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.save();
        ctx.translate(-cameraX, 0);

        // Ø±Ø³Ù… Ø§Ù„Ù…Ù†ØµØ§Øª
        platforms.forEach(p => {
            if (p.type === 'lava') {
                ctx.fillStyle = '#ff4b2b';
                ctx.shadowBlur = 20;
                ctx.shadowColor = "red";
            } else {
                ctx.fillStyle = '#1e272e'; // Ù„ÙˆÙ† Ø§Ù„Ø£Ø±Ø¶
                ctx.shadowBlur = 0;
                // Ø±Ø³Ù… Ø²Ø®Ø±ÙØ© Ø§Ù„Ø¹Ø´Ø¨
                ctx.fillStyle = '#2ecc71';
                ctx.fillRect(p.x, p.y, p.width, 5);
                ctx.fillStyle = '#34495e';
            }
            ctx.fillRect(p.x, p.y + (p.type==='lava'?5:0), p.width, p.height);
            ctx.shadowBlur = 0;
        });

        // Ø±Ø³Ù… Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©
        if (portal) {
            ctx.fillStyle = `rgba(0, 255, 255, ${Math.random()})`;
            ctx.beginPath();
            ctx.arc(portal.x + 20, portal.y + 20, 25, 0, Math.PI * 2);
            ctx.fill();
            ctx.font = "30px Arial";
            ctx.fillText("ğŸŒ€", portal.x - 5, portal.y + 30);
        }

        // Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨ (Ø¥ÙŠÙ…ÙˆØ¬ÙŠ + ØªÙˆÙ‡Ø¬)
        ctx.save();
        if (!player.facingRight) {
            ctx.translate(player.x + player.width, player.y);
            ctx.scale(-1, 1);
            ctx.fillText(player.sprite, 0, 35);
        } else {
            ctx.font = "35px Arial";
            ctx.shadowBlur = 10;
            ctx.shadowColor = "white";
            ctx.fillText(player.sprite, player.x, player.y + 35);
        }
        ctx.restore();

        // Ø±Ø³Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
        ctx.font = "35px Arial";
        enemies.forEach(e => {
            ctx.fillText(e.sprite, e.x, e.y + 35);
        });

        // Ø±Ø³Ù… Ø§Ù„Ø²Ø¹ÙŠÙ…
        if (boss) {
            ctx.font = "100px Arial";
            ctx.fillText(boss.sprite, boss.x, boss.y + 80);
            // Ø´Ø±ÙŠØ· ØµØ­Ø© Ø§Ù„Ø²Ø¹ÙŠÙ…
            ctx.fillStyle = "red";
            ctx.fillRect(boss.x, boss.y - 20, 100 * (boss.hp / boss.maxHp), 10);
        }

        // Ø±Ø³Ù… Ø§Ù„Ù…Ù‚Ø°ÙˆÙØ§Øª
        projectiles.forEach(proj => {
            ctx.fillText("ğŸ”¥", proj.x, proj.y);
        });

        // Ø±Ø³Ù… Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª
        particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.size, p.size);
        });

        ctx.restore();
        requestAnimationFrame(loop);
    }

    function loop() {
        update();
        draw();
    }

    // Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©
    function colCheck(shapeA, shapeB) {
        return (shapeA.x < shapeB.x + shapeB.width &&
                shapeA.x + shapeA.width > shapeB.x &&
                shapeA.y < shapeB.y + shapeB.height &&
                shapeA.y + shapeA.height > shapeB.y);
    }

    function createParticles(x, y, color, count) {
        for(let i=0; i<count; i++) {
            particles.push({
                x: x, y: y,
                velX: (Math.random() - 0.5) * 10,
                velY: (Math.random() - 0.5) * 10,
                life: 30,
                color: color,
                size: Math.random() * 5
            });
        }
    }

    // Ø¨Ø¯Ø¡ Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
    requestAnimationFrame(loop);

</script>
</body>
</html>
